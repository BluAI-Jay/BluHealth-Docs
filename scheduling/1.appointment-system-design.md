# Appointment Scheduling System - Design Documentation

## Conceptual Overview

### System Components

1. **User Management**
   - Patients: Can book, cancel, reschedule appointments
   - Physicians: Manage schedules, view appointments, access patient records
   - Office Staff: Manage appointments on behalf of patients, handle copays

2. **Schedule Management**
   - Physician availability (working days, hours, breaks)
   - Office/location management
   - Vacation and time-off tracking
   - Recurring schedule patterns

3. **Appointment Management**
   - Booking system with available time slots
   - Cancellation and rescheduling
   - Follow-up appointment scheduling
   - Appointment status tracking

4. **Financial Management**
   - Insurance copay tracking
   - Amount due calculation
   - Payment status monitoring

5. **Integration**
   - Patient record system integration
   - Real-time availability updates
   - Notification system

## Logical Architecture

### Database Schema

```sql
-- Users table (base for all user types)
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL, -- 'patient', 'physician', 'staff'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Patients
CREATE TABLE patients (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    date_of_birth DATE,
    phone VARCHAR(20),
    address TEXT,
    insurance_provider VARCHAR(100),
    insurance_id VARCHAR(50)
);

-- Physicians
CREATE TABLE physicians (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    specialization VARCHAR(100),
    license_number VARCHAR(50)
);

-- Office Staff
CREATE TABLE staff (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    department VARCHAR(100)
);

-- Locations
CREATE TABLE locations (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    address TEXT,
    phone VARCHAR(20)
);

-- Physician Schedules
CREATE TABLE physician_schedules (
    id SERIAL PRIMARY KEY,
    physician_id INTEGER REFERENCES physicians(id),
    location_id INTEGER REFERENCES locations(id),
    day_of_week INTEGER, -- 0-6 (Sunday-Saturday)
    start_time TIME,
    end_time TIME,
    lunch_start TIME,
    lunch_end TIME,
    is_active BOOLEAN DEFAULT true
);

-- Time Off
CREATE TABLE physician_time_off (
    id SERIAL PRIMARY KEY,
    physician_id INTEGER REFERENCES physicians(id),
    start_date DATE,
    end_date DATE,
    reason VARCHAR(100)
);

-- Appointments
CREATE TABLE appointments (
    id SERIAL PRIMARY KEY,
    patient_id INTEGER REFERENCES patients(id),
    physician_id INTEGER REFERENCES physicians(id),
    location_id INTEGER REFERENCES locations(id),
    appointment_date DATE,
    start_time TIME,
    end_time TIME,
    status VARCHAR(50) DEFAULT 'scheduled', -- 'scheduled', 'completed', 'cancelled', 'no-show'
    reason_for_visit TEXT,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Financial Records
CREATE TABLE appointment_financials (
    id SERIAL PRIMARY KEY,
    appointment_id INTEGER REFERENCES appointments(id),
    total_charge DECIMAL(10, 2),
    insurance_coverage DECIMAL(10, 2),
    copay_amount DECIMAL(10, 2),
    amount_due DECIMAL(10, 2),
    payment_status VARCHAR(50) DEFAULT 'pending', -- 'pending', 'partial', 'paid'
    payment_date DATE
);
```

### API Architecture

**Authentication & Authorization**
- JWT-based authentication
- Role-based access control (RBAC)
- Secure password hashing with bcrypt

**Core API Endpoints**

1. **Authentication**
   - POST `/api/auth/login`
   - POST `/api/auth/register`
   - POST `/api/auth/logout`
   - GET `/api/auth/me`

2. **Schedule Management**
   - GET `/api/physicians/:id/schedule`
   - POST `/api/physicians/:id/schedule`
   - PUT `/api/physicians/:id/schedule/:scheduleId`
   - DELETE `/api/physicians/:id/schedule/:scheduleId`
   - POST `/api/physicians/:id/time-off`
   - GET `/api/physicians/:id/available-slots`

3. **Appointment Management**
   - GET `/api/appointments`
   - GET `/api/appointments/:id`
   - POST `/api/appointments`
   - PUT `/api/appointments/:id`
   - DELETE `/api/appointments/:id`
   - POST `/api/appointments/:id/reschedule`

4. **Patient Management**
   - GET `/api/patients/:id`
   - PUT `/api/patients/:id`
   - GET `/api/patients/:id/appointments`

5. **Financial Management**
   - GET `/api/appointments/:id/financials`
   - PUT `/api/appointments/:id/financials`
   - POST `/api/appointments/:id/payment`

### Security Considerations

1. **Authentication**: Multi-factor authentication support
2. **Data Encryption**: Encrypt sensitive patient data at rest
3. **HIPAA Compliance**: Audit logs for all data access
4. **Session Management**: Secure session handling with timeouts
5. **Input Validation**: Comprehensive input sanitization

### Integration Points

1. **EHR Integration**: RESTful API to launch patient records
2. **Payment Gateway**: Integration for copay processing
3. **Notification Service**: Email/SMS for appointment reminders
4. **Calendar Sync**: Optional integration with external calendars